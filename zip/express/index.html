<!DOCTYPE html>
<htmllang="en">
<head>
  <metacharset="UTF-8">
  <title>上传文件</title>
</head>
  <link href='assets/lib/bootstrap.css' rel="stylesheet"'/>
  <style>
  .main {
    margin: 100px auto;
    width: 50%;
    font-family:'system-ui'
   
  }
  .main h1 {
     color: #666;
    font-weight: 400;
  }
  .main #upload {
    margin-top:20px;
    outline:none;
    border:none;
  }
  #tbox{
    margin-top: 30px;
    width: 720px;
    background-color:#fff; 
    height: 50px;
    border:1px solid #ddd;
  }
	#bar{
    width:0px; 
    height: 50px; 
    background-color: #79b8ff; 
    text-align:center;
    font-family:Tahoma;
    color: #fff;
    font-size: 18px; 
    line-height: 50px
  }
  </style>
  <body>
    
  <div class='main'>
    <h1>File Upload ervice
      <span id='status'></span>
    </h1>
    <form id="uploadForm" enctype="multipart/form-data" style="display: none;" > 
      <div class="form-group">
        <label for="exampleInputEmail1"> </label>
          <input id="file" type="file" name="file"/> 
      </div>
    </form> 
    <button class="btn btn-warning" id="upload">上传文件</button> 
    <a class="btn btn-success" href='./xfj.apk' id="upload" download="xfj">下载文件</a> 
    <div id="tbox">
      <div id="bar"></div>
    </div>
  </div>
  </body>
  <script src='assets/lib/jquery.js'></script>
  <script>
$(function () {
  var xhr = new XMLHttpRequest(); 
  xhr.upload.onprogress=function(e){}
  var xhrOnProgress = function(fun) {
    xhrOnProgress.onprogress = fun; //绑定监听
    // 使用闭包实现监听绑
    return function() {
      // 通过$.ajaxSettings.xhr();获得XMLHttpRequest对象
      var xhr = $.ajaxSettings.xhr();
      // 判断监听函数是否为函数
      if (typeof xhrOnProgress.onprogress !== 'function')
        return xhr;
      //如果有监听函数并且xhr对象支持绑定时就把监听函数绑定上去
      if (xhrOnProgress.onprogress && xhr.upload) {
        xhr.upload.onprogress = xhrOnProgress.onprogress;
      }
      return xhr;
    }
  }
  $("#upload").click(function () { 
    $("#file").click();
  }); 
  $("#file").change(function () {
    var formData = new FormData($('#uploadForm')[0]); 
    $.ajax({ 
      type: 'post', 
      url: "/file/uploading", 
      data: formData, 
      cache: false, 
      processData: false, 
      contentType: false,
      xhr: xhrOnProgress(function(e){
        var per = Math.floor(100 * e.loaded / e.total);//计算百分比
        $('#bar').css({'width': per + "%",});
        $('#bar').html(per+ '%');
      }), 
      success: function (data) { 
        if (data == '200') {
           $('#bar').html('部署完成')
        }
      },
      fail: function (params) {
        alert(params)
      }
    })
  });
}); 
  </script>
</html>